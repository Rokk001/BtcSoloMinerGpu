version: "3.8"

services:
  btcsominer:
    container_name: btcsominer-gpu
    build: .
    # If you publish an image, replace the two lines above with:
    # image: ghcr.io/yourorg/btcsominer-gpu:latest
    restart: unless-stopped
    environment:
      # REQUIRED: set your BTC wallet address
      - WALLET_ADDRESS=${WALLET_ADDRESS}
      # OPTIONAL: config path inside container
      - CONFIG_FILE=/app/config/config.toml
      # Compute backend: cpu | cuda | opencl
      - COMPUTE_BACKEND=${COMPUTE_BACKEND:-cpu}
      # GPU index for CUDA/OpenCL backends
      - GPU_DEVICE=${GPU_DEVICE:-0}
      # NVIDIA container runtime envs (only for NVIDIA GPU)
      - NVIDIA_VISIBLE_DEVICES=${NVIDIA_VISIBLE_DEVICES:-all}
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility
    volumes:
      - ./config:/app/config:ro
    # NVIDIA on Unraid (requires Nvidia Driver plugin):
    # uncomment the next line
    # runtime: nvidia
    # AMD/OpenCL (expose iGPU if used):
    # devices:
    #   - /dev/dri:/dev/dri
    command: ["python", "-m", "BtcSoloMinerGpu"]


